<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="professional portfolio" />

  <title>Admin Page</title>

  <!-- JavaScript libraries-->
  <script src='node_modules/jquery/dist/jquery.min.js'></script>
  <script src='node_modules/moment/min/moment.min.js'></script>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Custom fonts for this template -->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css" />
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"
    rel="stylesheet" type="text/css" />
  <link href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic"
    rel="stylesheet" type="text/css" />

  <!-- Plugin CSS -->
  <link href="vendor/magnific-popup/magnific-popup.css" rel="stylesheet" />

  <!-- Custom styles for this template -->
  <link href="css/creative.min.css" rel="stylesheet" />
</head>

<body id="page-top">
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand js-scroll-trigger" href="index.html">All Kinds Hair Co.</a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive"
        aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="about.html">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="services.html">Services</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="portfolio.html">Our Haircuts</a>
          </li>
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="appointment.html">Schedule an Appointment</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- Page Content -->
  <section class="bg-dark text-white">
    <h1 class="text-centered">Manage Appointments</h1>
  </section>
  <section class="bg-secondary">

    <div id="prime" class="container col-4">
    </div>
  </section>

  <script>
    $.get("/api/appointments").then(res => displayAppointments(res));

    function deleteAppointment(k) {
      $.ajax({
        type: 'DELETE',
        url: '/api/appointments',
        data: { "key": k },
        datatype: 'application/json'
      })
    }

    function displayAppointments(appointmentsArray) {
      appointmentsArray.forEach((appointment) => {
        var date = moment(appointment["start"]).format('LL');
        var name = appointment["name"];
        var startTime = moment(appointment["start"]).format('LT');
        var endTime = moment(appointment["end"]).format('LT');
        var haircut = appointment["haircut"];
        var additionalService = appointment["addOns"];
        var appointmentDuration = appointment["duration"];
        var dealsOrSpecial = appointment["deals"];
        var key = appointment["key"];

        // Create div element, class card.
        var divCard = document.createElement("div");
        divCard.setAttribute("class", "card");

        // Create h5 element of class card-header.
        var h5 = document.createElement("h5");
        h5.setAttribute("class", "card-header");
        var txtH5 = document.createTextNode(date);
        h5.appendChild(txtH5);

        // Create div element of class card-body.
        var divBody = document.createElement("div");
        divBody.setAttribute("class", "card-body");

        // Create p elements of class card-text.
        // name
        var pName = document.createElement("P");
        pName.setAttribute("class", "card-text");
        var txtName = document.createTextNode("Name: " + name);
        pName.appendChild(txtName);

        // appointment time
        var pTime = document.createElement("P");
        pTime.setAttribute("class", "card-text");
        var txtTime = document.createTextNode("Appointment: " + startTime + " - " + endTime);
        pTime.appendChild(txtTime);

        // haircut and additional services
        var pService = document.createElement("P");
        pService.setAttribute("class", "card-text");
        var txtService = document.createTextNode("Service: " + haircut + " and " + additionalService);
        pService.appendChild(txtService);

        // dealsOrSpecials
        var pDealsOrSpecials = document.createElement("P");
        pDealsOrSpecials.setAttribute("class", "card-text");
        var txtDealsOrSpecials = document.createTextNode("Deal / Special: " + dealsOrSpecial);
        pDealsOrSpecials.appendChild(txtDealsOrSpecials);

        // key
        var pKey = document.createElement("P");
        pKey.setAttribute("class", "card-text");
        pKey.setAttribute("id", "cancellationKey");
        pKey.setAttribute("value", key);
        var txtKey = document.createTextNode("Appointment Key: " + key);
        pKey.appendChild(txtKey);

        // create delete button
        var btnDelete = document.createElement("BUTTON");
        var txtLabel = document.createTextNode("Delete Appointment");
        btnDelete.setAttribute("class", "btn btn-primary")
        btnDelete.setAttribute("type", "button")
        btnDelete.setAttribute("onclick", "deleteAppointment(" + key + ")")
        btnDelete.appendChild(txtLabel);

        // linebreak
        var br = document.createElement("BR");

        // Compose card
        divBody.appendChild(pName);
        divBody.appendChild(pTime);
        divBody.appendChild(pService);
        divBody.appendChild(pDealsOrSpecials);
        divBody.appendChild(pKey);
        divBody.appendChild(btnDelete);
        divCard.appendChild(h5);
        divCard.appendChild(divBody);

        // Add card and spacing to DOM
        var appointmentContainer = document.getElementById("prime");
        appointmentContainer.appendChild(divCard);
        appointmentContainer.appendChild(br);
      })
    }

  </Script>
</body>